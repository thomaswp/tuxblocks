//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: tripleplay/syncdb/SyncDB.java
//
//  Created by Thomas on 7/1/13.
//

#import "Asserts.h"
#import "Codec.h"
#import "DBUtil.h"
#import "IOSClass.h"
#import "IOSObjectArray.h"
#import "Log.h"
#import "Logger.h"
#import "Platform.h"
#import "RMap.h"
#import "RSet.h"
#import "Resolver.h"
#import "SetResolver.h"
#import "Storage.h"
#import "Value.h"
#import "java/lang/Exception.h"
#import "java/lang/IllegalArgumentException.h"
#import "java/lang/Integer.h"
#import "java/lang/Iterable.h"
#import "java/util/Collection.h"
#import "java/util/Collections.h"
#import "java/util/HashMap.h"
#import "java/util/HashSet.h"
#import "java/util/Iterator.h"
#import "java/util/Map.h"
#import "java/util/Set.h"

@implementation TripleplaySyncdbSyncDB

static NSString * TripleplaySyncdbSyncDB_SYNC_VERS_KEY_ = @"syncv";
static NSString * TripleplaySyncdbSyncDB_SYNC_MODS_KEY_ = @"syncm";
static NSString * TripleplaySyncdbSyncDB_SYNC_PURGE_KEY_ = @"syncp";
static id<JavaUtilSet> TripleplaySyncdbSyncDB_SYNC_KEYS_;

- (id<PlaynCorePlatform>)_platform {
  return _platform_;
}
- (void)set_platform:(id<PlaynCorePlatform>)_platform {
  JreOperatorRetainedAssign(&_platform_, self, _platform);
}
@synthesize _platform = _platform_;
- (id<PlaynCoreStorage>)_storage {
  return _storage_;
}
- (void)set_storage:(id<PlaynCoreStorage>)_storage {
  JreOperatorRetainedAssign(&_storage_, self, _storage);
}
@synthesize _storage = _storage_;
- (id<PlaynCoreStorage_Batch>)_batch {
  return _batch_;
}
- (void)set_batch:(id<PlaynCoreStorage_Batch>)_batch {
  JreOperatorRetainedAssign(&_batch_, self, _batch);
}
@synthesize _batch = _batch_;
- (id<JavaUtilMap>)_props {
  return _props_;
}
- (void)set_props:(id<JavaUtilMap>)_props {
  JreOperatorRetainedAssign(&_props_, self, _props);
}
@synthesize _props = _props_;
- (id<JavaUtilMap>)_subdbs {
  return _subdbs_;
}
- (void)set_subdbs:(id<JavaUtilMap>)_subdbs {
  JreOperatorRetainedAssign(&_subdbs_, self, _subdbs);
}
@synthesize _subdbs = _subdbs_;
- (id<JavaUtilMap>)_mods {
  return _mods_;
}
- (void)set_mods:(id<JavaUtilMap>)_mods {
  JreOperatorRetainedAssign(&_mods_, self, _mods);
}
@synthesize _mods = _mods_;
@synthesize _version = _version_;
@synthesize _flushQueued = _flushQueued_;

+ (NSString *)SYNC_VERS_KEY {
  return TripleplaySyncdbSyncDB_SYNC_VERS_KEY_;
}

+ (NSString *)SYNC_MODS_KEY {
  return TripleplaySyncdbSyncDB_SYNC_MODS_KEY_;
}

+ (NSString *)SYNC_PURGE_KEY {
  return TripleplaySyncdbSyncDB_SYNC_PURGE_KEY_;
}

+ (id<JavaUtilSet>)SYNC_KEYS {
  return TripleplaySyncdbSyncDB_SYNC_KEYS_;
}

- (int)version__ {
  return _version_;
}

- (BOOL)hasUnsyncedChanges {
  return ![((id<JavaUtilMap>) NIL_CHK(_mods_)) isEmpty];
}

- (id<JavaUtilMap>)getDelta {
  id<JavaUtilMap> delta = [[[JavaUtilHashMap alloc] init] autorelease];
  {
    id<JavaUtilIterator> iter__ = ((id<JavaUtilIterator>) [((id<JavaUtilSet>) [((id<JavaUtilMap>) NIL_CHK(_mods_)) keySet]) iterator]);
    while ([((id<JavaUtilIterator>) NIL_CHK(iter__)) hasNext]) {
      NSString *name = ((NSString *) [((id<JavaUtilIterator>) NIL_CHK(iter__)) next]);
      (void) [((id<JavaUtilMap>) NIL_CHK(delta)) putWithId:name withId:[((id<PlaynCoreStorage>) NIL_CHK(_storage_)) getItemWithNSString:name]];
    }
  }
  return delta;
}

- (id<JavaUtilMap>)getMods {
  return [[[JavaUtilHashMap alloc] initWithJavaUtilMap:_mods_] autorelease];
}

- (void)noteSyncWithInt:(int)version_
        withJavaUtilMap:(id<JavaUtilMap>)syncedMods {
  {
    id<JavaUtilIterator> iter__ = ((id<JavaUtilIterator>) [((id<JavaUtilSet>) [((id<JavaUtilMap>) NIL_CHK(syncedMods)) entrySet]) iterator]);
    while ([((id<JavaUtilIterator>) NIL_CHK(iter__)) hasNext]) {
      id<JavaUtilMap_Entry> entry = ((id<JavaUtilMap_Entry>) [((id<JavaUtilIterator>) NIL_CHK(iter__)) next]);
      NSString *prop = ((NSString *) [((id<JavaUtilMap_Entry>) NIL_CHK(entry)) getKey]);
      JavaLangInteger *mcount = ((JavaLangInteger *) [((id<JavaUtilMap>) NIL_CHK(_mods_)) getWithId:prop]);
      if (mcount == nil) {
        [((TripleplayUtilLogger *) NIL_CHK([TripleplaySyncdbLog log])) warningWithNSString:@"Have no mod count for synced property?" withNSObjectArray:[IOSObjectArray arrayWithType:[IOSClass classWithClass:[NSObject class]] count:2, @"prop", prop ]];
        continue;
      }
      int syncedMC = [((JavaLangInteger *) [((id<JavaUtilMap_Entry>) NIL_CHK(entry)) getValue]) intValue], curMC = [((JavaLangInteger *) NIL_CHK(mcount)) intValue];
      if (syncedMC > curMC) {
        [((TripleplayUtilLogger *) NIL_CHK([TripleplaySyncdbLog log])) warningWithNSString:@"Synced mod count is greater than current?" withNSObjectArray:[IOSObjectArray arrayWithType:[IOSClass classWithClass:[NSObject class]] count:6, @"prop", prop, @"curMC", [JavaLangInteger valueOfWithInt:curMC], @"syncedMC", [JavaLangInteger valueOfWithInt:syncedMC] ]];
      }
      else if (syncedMC == curMC) {
        (void) [((id<JavaUtilMap>) NIL_CHK(_mods_)) removeWithId:prop];
      }
    }
  }
  [self flushMods];
  [self updateVersionWithInt:version_];
}

- (BOOL)containsMergesWithJavaUtilMap:(id<JavaUtilMap>)delta {
  {
    id<JavaUtilIterator> iter__ = ((id<JavaUtilIterator>) [((id<JavaUtilSet>) [((id<JavaUtilMap>) NIL_CHK(delta)) keySet]) iterator]);
    while ([((id<JavaUtilIterator>) NIL_CHK(iter__)) hasNext]) {
      NSString *key = ((NSString *) [((id<JavaUtilIterator>) NIL_CHK(iter__)) next]);
      if ([((id<JavaUtilMap>) NIL_CHK(_mods_)) containsKeyWithId:key]) return YES;
    }
  }
  return NO;
}

- (void)applyDeltaWithInt:(int)version_
          withJavaUtilMap:(id<JavaUtilMap>)delta {
  id<JavaUtilSet> subDBs = [[[JavaUtilHashSet alloc] init] autorelease];
  {
    id<JavaUtilIterator> iter__ = ((id<JavaUtilIterator>) [((id<JavaUtilSet>) [((id<JavaUtilMap>) NIL_CHK(delta)) keySet]) iterator]);
    while ([((id<JavaUtilIterator>) NIL_CHK(iter__)) hasNext]) {
      NSString *key = ((NSString *) [((id<JavaUtilIterator>) NIL_CHK(iter__)) next]);
      NSString *sdb = [TripleplaySyncdbDBUtil subDBWithNSString:key];
      if (sdb != nil) [((id<JavaUtilSet>) NIL_CHK(subDBs)) addWithId:sdb];
    }
  }
  if (![((id<JavaUtilSet>) NIL_CHK(subDBs)) isEmpty]) {
    id<JavaUtilIterator> iter__ = ((id<JavaUtilIterator>) [((id<JavaUtilSet>) NIL_CHK(subDBs)) iterator]);
    while ([((id<JavaUtilIterator>) NIL_CHK(iter__)) hasNext]) {
      NSString *subdb = ((NSString *) [((id<JavaUtilIterator>) NIL_CHK(iter__)) next]);
      (void) [self getSubDBWithNSString:subdb];
    }
  }
  [self startBatch];
  @try {
    {
      id<JavaUtilIterator> iter__ = ((id<JavaUtilIterator>) [((id<JavaUtilSet>) [((id<JavaUtilMap>) NIL_CHK(delta)) entrySet]) iterator]);
      while ([((id<JavaUtilIterator>) NIL_CHK(iter__)) hasNext]) {
        id<JavaUtilMap_Entry> entry = ((id<JavaUtilMap_Entry>) [((id<JavaUtilIterator>) NIL_CHK(iter__)) next]);
        NSString *name = ((NSString *) [((id<JavaUtilMap_Entry>) NIL_CHK(entry)) getKey]), *value = ((NSString *) [((id<JavaUtilMap_Entry>) NIL_CHK(entry)) getValue]);
        id<TripleplaySyncdbSyncDB_Property> prop;
        int pidx = [NIL_CHK(name) indexOfString:[TripleplaySyncdbDBUtil MAP_KEY_SEP]];
        if (pidx == -1) prop = ((id<TripleplaySyncdbSyncDB_Property>) [((id<JavaUtilMap>) NIL_CHK(_props_)) getWithId:name]);
        else prop = ((id<TripleplaySyncdbSyncDB_Property>) [((id<JavaUtilMap>) NIL_CHK(_props_)) getWithId:[NIL_CHK(name) substring:0 endIndex:pidx]]);
        if (prop == nil) {
          [((TripleplayUtilLogger *) NIL_CHK([TripleplaySyncdbLog log])) warningWithNSString:@"No local property defined" withNSObjectArray:[IOSObjectArray arrayWithType:[IOSClass classWithClass:[NSObject class]] count:2, @"name", name ]];
        }
        else if ([((id<JavaUtilMap>) NIL_CHK(_mods_)) containsKeyWithId:name]) {
          @try {
            if ([prop mergeWithNSString:name withNSString:value]) (void) [((id<JavaUtilMap>) NIL_CHK(_mods_)) removeWithId:name];
          }
          @catch (JavaLangException *e) {
            [((TripleplayUtilLogger *) NIL_CHK([TripleplaySyncdbLog log])) warningWithNSString:@"Property merge fail" withNSObjectArray:[IOSObjectArray arrayWithType:[IOSClass classWithClass:[NSObject class]] count:5, @"name", name, @"value", value, e ]];
          }
        }
        else {
          @try {
            [prop updateWithNSString:name withNSString:value];
          }
          @catch (JavaLangException *e) {
            [((TripleplayUtilLogger *) NIL_CHK([TripleplaySyncdbLog log])) warningWithNSString:@"Property update fail" withNSObjectArray:[IOSObjectArray arrayWithType:[IOSClass classWithClass:[NSObject class]] count:5, @"name", name, @"value", value, e ]];
          }
          (void) [((id<JavaUtilMap>) NIL_CHK(_mods_)) removeWithId:name];
        }
      }
    }
    [self flushMods];
    [self updateVersionWithInt:version_];
  }
  @finally {
    [self commitBatch];
  }
}

- (void)prepareToMeld {
  [self updateVersionWithInt:0];
  {
    id<JavaUtilIterator> iter__ = ((id<JavaUtilIterator>) [((id<JavaUtilCollection>) [((id<JavaUtilMap>) NIL_CHK(_props_)) values]) iterator]);
    while ([((id<JavaUtilIterator>) NIL_CHK(iter__)) hasNext]) {
      id<TripleplaySyncdbSyncDB_Property> prop = ((id<TripleplaySyncdbSyncDB_Property>) [((id<JavaUtilIterator>) NIL_CHK(iter__)) next]);
      [((id<TripleplaySyncdbSyncDB_Property>) NIL_CHK(prop)) prepareToMeld];
    }
  }
}

- (void)processPurges {
  [self startBatch];
  @try {
    [self purgeDBsWithJavaUtilSet:((id<JavaUtilSet>) [self sgetWithNSString:TripleplaySyncdbSyncDB_SYNC_PURGE_KEY_ withTripleplaySyncdbCodec:[TripleplaySyncdbCodec STRING]])];
    [self removeItemWithNSString:TripleplaySyncdbSyncDB_SYNC_PURGE_KEY_];
  }
  @finally {
    [self commitBatch];
  }
}

- (id)initWithPlaynCorePlatform:(id<PlaynCorePlatform>)platform {
  if ((self = [super init])) {
    JreOperatorRetainedAssign(&_props_, self, [[[JavaUtilHashMap alloc] init] autorelease]);
    JreOperatorRetainedAssign(&_subdbs_, self, [[[JavaUtilHashMap alloc] init] autorelease]);
    JreOperatorRetainedAssign(&_mods_, self, [[[JavaUtilHashMap alloc] init] autorelease]);
    JreOperatorRetainedAssign(&_platform_, self, platform);
    JreOperatorRetainedAssign(&_storage_, self, [((id<PlaynCorePlatform>) NIL_CHK(platform)) storage]);
    _version_ = [((JavaLangInteger *) [self getWithNSString:TripleplaySyncdbSyncDB_SYNC_VERS_KEY_ withId:[JavaLangInteger valueOfWithInt:0] withTripleplaySyncdbCodec:[TripleplaySyncdbCodec INT]]) intValue];
    {
      id<JavaUtilIterator> iter__ = ((id<JavaUtilIterator>) [((id<JavaUtilSet>) [self sgetWithNSString:TripleplaySyncdbSyncDB_SYNC_MODS_KEY_ withTripleplaySyncdbCodec:[TripleplaySyncdbCodec STRING]]) iterator]);
      while ([((id<JavaUtilIterator>) NIL_CHK(iter__)) hasNext]) {
        NSString *mod = ((NSString *) [((id<JavaUtilIterator>) NIL_CHK(iter__)) next]);
        (void) [((id<JavaUtilMap>) NIL_CHK(_mods_)) putWithId:mod withId:[JavaLangInteger valueOfWithInt:1]];
      }
    }
  }
  return self;
}

- (ReactValue *)valueWithNSString:(NSString *)name
                           withId:(id)defval
        withTripleplaySyncdbCodec:(TripleplaySyncdbCodec *)codec
     withTripleplaySyncdbResolver:(id<TripleplaySyncdbResolver>)resolver {
  [PlaynCoreAsserts checkArgumentWithBOOL:![((id<JavaUtilSet>) NIL_CHK(TripleplaySyncdbSyncDB_SYNC_KEYS_)) containsWithId:name] withId:[NSString stringWithFormat:@"%@ is a reserved name.", name]];
  ReactValue *value = [[[TripleplaySyncdbSyncDB_$1 alloc] initWithTripleplaySyncdbSyncDB:self withId:nil withNSString:name withId:defval withTripleplaySyncdbCodec:codec] autorelease];
  (void) [((id<JavaUtilMap>) NIL_CHK(_props_)) putWithId:name withId:[[[TripleplaySyncdbSyncDB_$2 alloc] initWithTripleplaySyncdbSyncDB:self withTripleplaySyncdbCodec:codec withId:defval withTripleplaySyncdbResolver:resolver withReactValue:value withNSString:name] autorelease]];
  return value;
}

- (ReactRSet *)setWithNSString:(NSString *)name
     withTripleplaySyncdbCodec:(TripleplaySyncdbCodec *)codec
withTripleplaySyncdbSetResolver:(id<TripleplaySyncdbSetResolver>)resolver {
  [PlaynCoreAsserts checkArgumentWithBOOL:![((id<JavaUtilSet>) NIL_CHK(TripleplaySyncdbSyncDB_SYNC_KEYS_)) containsWithId:name] withId:[NSString stringWithFormat:@"%@ is a reserved name.", name]];
  ReactRSet *rset = [[[TripleplaySyncdbSyncDB_$3 alloc] initWithTripleplaySyncdbSyncDB:self withJavaUtilSet:((id<JavaUtilSet>) [self sgetWithNSString:name withTripleplaySyncdbCodec:codec]) withNSString:name withTripleplaySyncdbCodec:codec] autorelease];
  (void) [((id<JavaUtilMap>) NIL_CHK(_props_)) putWithId:name withId:[[[TripleplaySyncdbSyncDB_$4 alloc] initWithTripleplaySyncdbSyncDB:self withTripleplaySyncdbCodec:codec withTripleplaySyncdbSetResolver:resolver withReactRSet:rset withNSString:name] autorelease]];
  return rset;
}

- (ReactRMap *)mapWithNSString:(NSString *)prefix
     withTripleplaySyncdbCodec:(TripleplaySyncdbCodec *)keyCodec
     withTripleplaySyncdbCodec:(TripleplaySyncdbCodec *)valCodec
  withTripleplaySyncdbResolver:(id<TripleplaySyncdbResolver>)resolver {
  ReactRMap *map = [[[ReactRMap alloc] initWithJavaUtilMap:[[[TripleplaySyncdbSyncDB_map_StorageMap alloc] initWithTripleplaySyncdbSyncDB:self] autorelease]] autorelease];
  (void) [((id<JavaUtilMap>) NIL_CHK(_props_)) putWithId:prefix withId:[[[TripleplaySyncdbSyncDB_$5 alloc] initWithTripleplaySyncdbSyncDB:self withTripleplaySyncdbCodec:keyCodec withNSString:prefix withReactRMap:map withTripleplaySyncdbCodec:valCodec withTripleplaySyncdbResolver:resolver] autorelease]];
  (void) [((id<JavaUtilMap>) NIL_CHK(_props_)) putWithId:[TripleplaySyncdbSyncDB mapKeysKeyWithNSString:prefix] withId:[[[TripleplaySyncdbSyncDB_$6 alloc] init] autorelease]];
  return map;
}

- (TripleplaySyncdbSyncDB_SubDB *)getSubDBWithNSString:(NSString *)prefix {
  TripleplaySyncdbSyncDB_SubDB *db = ((TripleplaySyncdbSyncDB_SubDB *) [((id<JavaUtilMap>) NIL_CHK(_subdbs_)) getWithId:prefix]);
  if (db == nil) (void) [((id<JavaUtilMap>) NIL_CHK(_subdbs_)) putWithId:prefix withId:db = [self createSubDBWithNSString:prefix]];
  return db;
}

- (TripleplaySyncdbSyncDB_SubDB *)createSubDBWithNSString:(NSString *)prefix {
  @throw [[[JavaLangIllegalArgumentException alloc] initWithNSString:[NSString stringWithFormat:@"Unknown subdb prefix: %@", prefix]] autorelease];
}

- (id)getWithNSString:(NSString *)name
               withId:(id)defval
withTripleplaySyncdbCodec:(TripleplaySyncdbCodec *)codec {
  return [((TripleplaySyncdbCodec *) NIL_CHK(codec)) decodeWithNSString:[((id<PlaynCoreStorage>) NIL_CHK(_storage_)) getItemWithNSString:name] withId:defval];
}

- (void)setWithNSString:(NSString *)name
                 withId:(id)value
withTripleplaySyncdbCodec:(TripleplaySyncdbCodec *)codec {
  [self setItemWithNSString:name withNSString:[((TripleplaySyncdbCodec *) NIL_CHK(codec)) encodeWithId:value]];
}

- (void)ssetWithNSString:(NSString *)name
         withJavaUtilSet:(id<JavaUtilSet>)set
withTripleplaySyncdbCodec:(TripleplaySyncdbCodec *)codec {
  [self setItemWithNSString:name withNSString:[TripleplaySyncdbDBUtil encodeSetWithJavaUtilSet:set withTripleplaySyncdbCodec:codec]];
}

- (id<JavaUtilSet>)sgetWithNSString:(NSString *)name
          withTripleplaySyncdbCodec:(TripleplaySyncdbCodec *)codec {
  return ((id<JavaUtilSet>) [TripleplaySyncdbDBUtil decodeSetWithNSString:[((id<PlaynCoreStorage>) NIL_CHK(_storage_)) getItemWithNSString:name] withTripleplaySyncdbCodec:codec]);
}

- (void)updateVersionWithInt:(int)version_ {
  [self setWithNSString:TripleplaySyncdbSyncDB_SYNC_VERS_KEY_ withId:[JavaLangInteger valueOfWithInt:_version_ = version_] withTripleplaySyncdbCodec:[TripleplaySyncdbCodec INT]];
}

- (void)noteModifiedWithNSString:(NSString *)name {
  JavaLangInteger *omods = ((JavaLangInteger *) [((id<JavaUtilMap>) NIL_CHK(_mods_)) getWithId:name]);
  (void) [((id<JavaUtilMap>) NIL_CHK(_mods_)) putWithId:name withId:[JavaLangInteger valueOfWithInt:(omods == nil) ? 1 : [((JavaLangInteger *) NIL_CHK(omods)) intValue] + 1]];
  if (omods == nil) [self queueFlushMods];
}

- (void)flushMods {
  [self ssetWithNSString:TripleplaySyncdbSyncDB_SYNC_MODS_KEY_ withJavaUtilSet:((id<JavaUtilSet>) [((id<JavaUtilMap>) NIL_CHK(_mods_)) keySet]) withTripleplaySyncdbCodec:[TripleplaySyncdbCodec STRING]];
}

- (void)queueFlushMods {
  if (_flushQueued_) return;
  _flushQueued_ = YES;
  [((id<PlaynCorePlatform>) NIL_CHK(_platform_)) invokeLaterWithJavaLangRunnable:[[[TripleplaySyncdbSyncDB_$7 alloc] initWithTripleplaySyncdbSyncDB:self] autorelease]];
}

- (void)startBatch {
  if (_batch_ == nil) JreOperatorRetainedAssign(&_batch_, self, [((id<PlaynCoreStorage>) NIL_CHK(_storage_)) startBatch]);
}

- (void)commitBatch {
  if (_batch_ != nil) {
    [_batch_ commit];
    JreOperatorRetainedAssign(&_batch_, self, nil);
  }
}

- (void)setItemWithNSString:(NSString *)key
               withNSString:(NSString *)value {
  if (_batch_ != nil) [_batch_ setItemWithNSString:key withNSString:value];
  else [((id<PlaynCoreStorage>) NIL_CHK(_storage_)) setItemWithNSString:key withNSString:value];
}

- (void)removeItemWithNSString:(NSString *)key {
  if (_batch_ != nil) [_batch_ removeItemWithNSString:key];
  else [((id<PlaynCoreStorage>) NIL_CHK(_storage_)) removeItemWithNSString:key];
}

- (void)purgeDBsWithJavaUtilSet:(id<JavaUtilSet>)dbs {
  if ([((id<JavaUtilSet>) NIL_CHK(dbs)) isEmpty]) return;
  [((TripleplayUtilLogger *) NIL_CHK([TripleplaySyncdbLog log])) infoWithNSString:@"Purging" withNSObjectArray:[IOSObjectArray arrayWithType:[IOSClass classWithClass:[NSObject class]] count:2, @"dbs", dbs ]];
  {
    id<JavaUtilIterator> iter__ = ((id<JavaUtilIterator>) [[((id<PlaynCoreStorage>) NIL_CHK(_storage_)) keys] iterator]);
    while ([((id<JavaUtilIterator>) NIL_CHK(iter__)) hasNext]) {
      NSString *key = ((NSString *) [((id<JavaUtilIterator>) NIL_CHK(iter__)) next]);
      int sdbidx = [NIL_CHK(key) indexOfString:[TripleplaySyncdbDBUtil SUBDB_KEY_SEP]];
      if (sdbidx == -1 || ![((id<JavaUtilSet>) NIL_CHK(dbs)) containsWithId:[NIL_CHK(key) substring:0 endIndex:sdbidx]]) continue;
      [self removeItemWithNSString:key];
      (void) [((id<JavaUtilMap>) NIL_CHK(_mods_)) removeWithId:key];
    }
  }
  [self flushMods];
}

+ (NSString *)mapKeysKeyWithNSString:(NSString *)mapPrefix {
  return [NSString stringWithFormat:@"%@_keys", mapPrefix];
}

+ (void)initialize {
  if (self == [TripleplaySyncdbSyncDB class]) {
    JreOperatorRetainedAssign(&TripleplaySyncdbSyncDB_SYNC_KEYS_, self, [[[JavaUtilHashSet alloc] init] autorelease]);
    {
      [((id<JavaUtilSet>) NIL_CHK(TripleplaySyncdbSyncDB_SYNC_KEYS_)) addWithId:TripleplaySyncdbSyncDB_SYNC_VERS_KEY_];
      [((id<JavaUtilSet>) NIL_CHK(TripleplaySyncdbSyncDB_SYNC_KEYS_)) addWithId:TripleplaySyncdbSyncDB_SYNC_MODS_KEY_];
    }
  }
}

- (void)dealloc {
  JreOperatorRetainedAssign(&_mods_, self, nil);
  JreOperatorRetainedAssign(&_subdbs_, self, nil);
  JreOperatorRetainedAssign(&_props_, self, nil);
  JreOperatorRetainedAssign(&_batch_, self, nil);
  JreOperatorRetainedAssign(&_storage_, self, nil);
  JreOperatorRetainedAssign(&_platform_, self, nil);
  [super dealloc];
}

- (void)copyAllPropertiesTo:(id)copy {
  [super copyAllPropertiesTo:copy];
  TripleplaySyncdbSyncDB *typedCopy = (TripleplaySyncdbSyncDB *) copy;
  typedCopy._platform = _platform_;
  typedCopy._storage = _storage_;
  typedCopy._batch = _batch_;
  typedCopy._props = _props_;
  typedCopy._subdbs = _subdbs_;
  typedCopy._mods = _mods_;
  typedCopy._version = _version_;
  typedCopy._flushQueued = _flushQueued_;
}

@end
@implementation TripleplaySyncdbSyncDB_map_StorageMap

- (TripleplaySyncdbSyncDB *)this$0 {
  return this$0_;
}
- (void)setThis$0:(TripleplaySyncdbSyncDB *)this$0 {
  JreOperatorRetainedAssign(&this$0_, self, this$0);
}
@synthesize this$0 = this$0_;
- (id<JavaUtilSet>)_keys {
  return _keys_;
}
- (void)set_keys:(id<JavaUtilSet>)_keys {
  JreOperatorRetainedAssign(&_keys_, self, _keys);
}
@synthesize _keys = _keys_;

- (int)size {
  return [((id<JavaUtilSet>) NIL_CHK(_keys_)) size];
}

- (BOOL)containsKeyWithId:(id)key {
  return [((id<JavaUtilSet>) NIL_CHK(_keys_)) containsWithId:key];
}

- (id)getWithId:(id)rawKey {
  return [((TripleplaySyncdbCodec *) NIL_CHK(val$valCodec_)) decodeWithNSString:[((id<PlaynCoreStorage>) NIL_CHK(this$0_._storage)) getItemWithNSString:[self skeyWithId:rawKey]] withId:nil];
}

- (id)putWithId:(id)key
         withId:(id)value {
  [((id<JavaUtilSet>) NIL_CHK(_keys_)) addWithId:key];
  NSString *skey = [self skeyWithId:key];
  NSString *valstr = [((TripleplaySyncdbCodec *) NIL_CHK(val$valCodec_)) encodeWithId:value];
  NSString *ovalstr = [((id<PlaynCoreStorage>) NIL_CHK(this$0_._storage)) getItemWithNSString:skey];
  [this$0_ setItemWithNSString:skey withNSString:valstr];
  if (![NIL_CHK(valstr) isEqual:ovalstr]) [this$0_ noteModifiedWithNSString:skey];
  return [((TripleplaySyncdbCodec *) NIL_CHK(val$valCodec_)) decodeWithNSString:ovalstr withId:nil];
}

- (id)removeWithId:(id)rawKey {
  NSString *ovalue = [((id<PlaynCoreStorage>) NIL_CHK(this$0_._storage)) getItemWithNSString:[self skeyWithId:rawKey]];
  [((id<JavaUtilSet>) NIL_CHK(_keys_)) removeWithId:rawKey];
  return [((TripleplaySyncdbCodec *) NIL_CHK(val$valCodec_)) decodeWithNSString:ovalue withId:nil];
}

- (id<JavaUtilSet>)keySet {
  return ((id<JavaUtilSet>) [JavaUtilCollections unmodifiableSetWithJavaUtilSet:_keys_]);
}

- (id<JavaUtilSet>)entrySet {
  return [[[TripleplaySyncdbSyncDB_map_StorageMap_$1 alloc] initWithTripleplaySyncdbSyncDB_map_StorageMap:self] autorelease];
}

- (NSString *)skeyWithId:(id)rawKey {
  id key = (id) rawKey;
  return [TripleplaySyncdbDBUtil mapKeyWithNSString:val$prefix_ withId:key withTripleplaySyncdbCodec:val$keyCodec_];
}

- (id)initWithTripleplaySyncdbSyncDB:(TripleplaySyncdbSyncDB *)outer$ {
  if ((self = [super init])) {
    JreOperatorRetainedAssign(&this$0_, self, outer$);
    JreOperatorRetainedAssign(&_keys_, self, [[[TripleplaySyncdbSyncDB_map_StorageMap_$2 alloc] initWithTripleplaySyncdbSyncDB_map_StorageMap:self withJavaUtilSet:((id<JavaUtilSet>) [outer$ sgetWithNSString:[TripleplaySyncdbSyncDB mapKeysKeyWithNSString:val$prefix_] withTripleplaySyncdbCodec:val$keyCodec_])] autorelease]);
  }
  return self;
}

- (void)dealloc {
  JreOperatorRetainedAssign(&_keys_, self, nil);
  JreOperatorRetainedAssign(&this$0_, self, nil);
  [super dealloc];
}

- (void)copyAllPropertiesTo:(id)copy {
  [super copyAllPropertiesTo:copy];
  TripleplaySyncdbSyncDB_map_StorageMap *typedCopy = (TripleplaySyncdbSyncDB_map_StorageMap *) copy;
  typedCopy.this$0 = this$0_;
  typedCopy._keys = _keys_;
}

@end
@implementation TripleplaySyncdbSyncDB_map_StorageMap_$1

- (TripleplaySyncdbSyncDB_map_StorageMap *)this$0 {
  return this$0_;
}
- (void)setThis$0:(TripleplaySyncdbSyncDB_map_StorageMap *)this$0 {
  JreOperatorRetainedAssign(&this$0_, self, this$0);
}
@synthesize this$0 = this$0_;

- (id<JavaUtilIterator>)iterator {
  return [[[TripleplaySyncdbSyncDB_map_StorageMap_$1_$1 alloc] initWithTripleplaySyncdbSyncDB_map_StorageMap_$1:self] autorelease];
}

- (int)size {
  return [((id<JavaUtilSet>) NIL_CHK(this$0_._keys)) size];
}

- (id)initWithTripleplaySyncdbSyncDB_map_StorageMap:(TripleplaySyncdbSyncDB_map_StorageMap *)outer$ {
  if ((self = [super init])) {
    JreOperatorRetainedAssign(&this$0_, self, outer$);
  }
  return self;
}

- (void)dealloc {
  JreOperatorRetainedAssign(&this$0_, self, nil);
  [super dealloc];
}

- (void)copyAllPropertiesTo:(id)copy {
  [super copyAllPropertiesTo:copy];
  TripleplaySyncdbSyncDB_map_StorageMap_$1 *typedCopy = (TripleplaySyncdbSyncDB_map_StorageMap_$1 *) copy;
  typedCopy.this$0 = this$0_;
}

@end
@implementation TripleplaySyncdbSyncDB_map_StorageMap_$1_$1

- (TripleplaySyncdbSyncDB_map_StorageMap_$1 *)this$0 {
  return this$0_;
}
- (void)setThis$0:(TripleplaySyncdbSyncDB_map_StorageMap_$1 *)this$0 {
  JreOperatorRetainedAssign(&this$0_, self, this$0);
}
@synthesize this$0 = this$0_;
- (id<JavaUtilIterator>)_keysIter {
  return _keysIter_;
}
- (void)set_keysIter:(id<JavaUtilIterator>)_keysIter {
  JreOperatorRetainedAssign(&_keysIter_, self, _keysIter);
}
@synthesize _keysIter = _keysIter_;

- (BOOL)hasNext {
  return [((id<JavaUtilIterator>) NIL_CHK(_keysIter_)) hasNext];
}

- (id<JavaUtilMap_Entry>)next {
  id key = [((id<JavaUtilIterator>) NIL_CHK(_keysIter_)) next];
  return [[[TripleplaySyncdbSyncDB_map_StorageMap_$1_$1_$1 alloc] initWithTripleplaySyncdbSyncDB_map_StorageMap_$1_$1:self withId:key] autorelease];
}

- (void)remove {
  [((id<JavaUtilIterator>) NIL_CHK(_keysIter_)) remove];
}

- (id)initWithTripleplaySyncdbSyncDB_map_StorageMap_$1:(TripleplaySyncdbSyncDB_map_StorageMap_$1 *)outer$ {
  if ((self = [super init])) {
    JreOperatorRetainedAssign(&this$0_, self, outer$);
    JreOperatorRetainedAssign(&_keysIter_, self, ((id<JavaUtilIterator>) [((id<JavaUtilSet>) NIL_CHK(outer$.this$0._keys)) iterator]));
  }
  return self;
}

- (void)dealloc {
  JreOperatorRetainedAssign(&_keysIter_, self, nil);
  JreOperatorRetainedAssign(&this$0_, self, nil);
  [super dealloc];
}

- (void)copyAllPropertiesTo:(id)copy {
  [super copyAllPropertiesTo:copy];
  TripleplaySyncdbSyncDB_map_StorageMap_$1_$1 *typedCopy = (TripleplaySyncdbSyncDB_map_StorageMap_$1_$1 *) copy;
  typedCopy.this$0 = this$0_;
  typedCopy._keysIter = _keysIter_;
}

@end
@implementation TripleplaySyncdbSyncDB_map_StorageMap_$1_$1_$1

- (TripleplaySyncdbSyncDB_map_StorageMap_$1_$1 *)this$0 {
  return this$0_;
}
- (void)setThis$0:(TripleplaySyncdbSyncDB_map_StorageMap_$1_$1 *)this$0 {
  JreOperatorRetainedAssign(&this$0_, self, this$0);
}
@synthesize this$0 = this$0_;
- (id)val$key {
  return val$key_;
}
- (void)setVal$key:(id)val$key {
  JreOperatorRetainedAssign(&val$key_, self, val$key);
}
@synthesize val$key = val$key_;

- (id)getKey {
  return val$key_;
}

- (id)getValue {
  return [this$0_.this$0.this$0 getWithId:val$key_];
}

- (id)setValueWithId:(id)value {
  return [this$0_.this$0.this$0 putWithId:val$key_ withId:value];
}

- (BOOL)isEqual:(id)param0 {
  // can't call an abstract method
  [self doesNotRecognizeSelector:_cmd];
  return 0;
}

- (NSUInteger)hash {
  // can't call an abstract method
  [self doesNotRecognizeSelector:_cmd];
  return 0;
}

- (id)initWithTripleplaySyncdbSyncDB_map_StorageMap_$1_$1:(TripleplaySyncdbSyncDB_map_StorageMap_$1_$1 *)outer$
                                                   withId:(id)capture$0 {
  if ((self = [super init])) {
    JreOperatorRetainedAssign(&this$0_, self, outer$);
    JreOperatorRetainedAssign(&val$key_, self, capture$0);
  }
  return self;
}

- (void)dealloc {
  JreOperatorRetainedAssign(&val$key_, self, nil);
  JreOperatorRetainedAssign(&this$0_, self, nil);
  [super dealloc];
}

- (void)copyAllPropertiesTo:(id)copy {
  [super copyAllPropertiesTo:copy];
  TripleplaySyncdbSyncDB_map_StorageMap_$1_$1_$1 *typedCopy = (TripleplaySyncdbSyncDB_map_StorageMap_$1_$1_$1 *) copy;
  typedCopy.this$0 = this$0_;
  typedCopy.val$key = val$key_;
}

@end
@implementation TripleplaySyncdbSyncDB_map_StorageMap_$2

- (TripleplaySyncdbSyncDB_map_StorageMap *)this$0 {
  return this$0_;
}
- (void)setThis$0:(TripleplaySyncdbSyncDB_map_StorageMap *)this$0 {
  JreOperatorRetainedAssign(&this$0_, self, this$0);
}
@synthesize this$0 = this$0_;
@synthesize _superctordone = _superctordone_;

- (BOOL)addWithId:(id)elem {
  if (!_superctordone_) return (BOOL) [super addWithId:elem];
  if (![super addWithId:elem]) return NO;
  [this$0_.this$0 ssetWithNSString:[TripleplaySyncdbSyncDB mapKeysKeyWithNSString:this$0_.val$prefix] withJavaUtilSet:self withTripleplaySyncdbCodec:this$0_.val$keyCodec];
  return YES;
}

- (BOOL)removeWithId:(id)elem {
  if (![super removeWithId:elem]) return NO;
  id key = (id) elem;
  [self removeStorageWithId:key];
  [this$0_.this$0 ssetWithNSString:[TripleplaySyncdbSyncDB mapKeysKeyWithNSString:this$0_.val$prefix] withJavaUtilSet:self withTripleplaySyncdbCodec:this$0_.val$keyCodec];
  return YES;
}

- (id<JavaUtilIterator>)iterator {
  id<JavaUtilIterator> iter = [super iterator];
  return [[[TripleplaySyncdbSyncDB_map_StorageMap_$2_$1 alloc] initWithTripleplaySyncdbSyncDB_map_StorageMap_$2:self withJavaUtilIterator:iter] autorelease];
}

- (void)removeStorageWithId:(id)key {
  NSString *skey = [this$0_ skeyWithId:key];
  [this$0_.this$0 removeItemWithNSString:skey];
  [this$0_.this$0 noteModifiedWithNSString:skey];
}

- (id)initWithTripleplaySyncdbSyncDB_map_StorageMap:(TripleplaySyncdbSyncDB_map_StorageMap *)outer$
                                    withJavaUtilSet:(id<JavaUtilSet>)arg$0 {
  if ((self = [super initWithJavaUtilCollection:arg$0])) {
    JreOperatorRetainedAssign(&this$0_, self, outer$);
    _superctordone_ = YES;
  }
  return self;
}

- (void)dealloc {
  JreOperatorRetainedAssign(&this$0_, self, nil);
  [super dealloc];
}

- (void)copyAllPropertiesTo:(id)copy {
  [super copyAllPropertiesTo:copy];
  TripleplaySyncdbSyncDB_map_StorageMap_$2 *typedCopy = (TripleplaySyncdbSyncDB_map_StorageMap_$2 *) copy;
  typedCopy.this$0 = this$0_;
  typedCopy._superctordone = _superctordone_;
}

@end
@implementation TripleplaySyncdbSyncDB_map_StorageMap_$2_$1

- (TripleplaySyncdbSyncDB_map_StorageMap_$2 *)this$0 {
  return this$0_;
}
- (void)setThis$0:(TripleplaySyncdbSyncDB_map_StorageMap_$2 *)this$0 {
  JreOperatorRetainedAssign(&this$0_, self, this$0);
}
@synthesize this$0 = this$0_;
- (id)_current {
  return _current_;
}
- (void)set_current:(id)_current {
  JreOperatorRetainedAssign(&_current_, self, _current);
}
@synthesize _current = _current_;
- (id<JavaUtilIterator>)val$iter {
  return val$iter_;
}
- (void)setVal$iter:(id<JavaUtilIterator>)val$iter {
  JreOperatorRetainedAssign(&val$iter_, self, val$iter);
}
@synthesize val$iter = val$iter_;

- (BOOL)hasNext {
  return [((id<JavaUtilIterator>) NIL_CHK(val$iter_)) hasNext];
}

- (id)next {
  return JreOperatorRetainedAssign(&_current_, self, [((id<JavaUtilIterator>) NIL_CHK(val$iter_)) next]);
}

- (void)remove {
  [((id<JavaUtilIterator>) NIL_CHK(val$iter_)) remove];
  [this$0_ removeStorageWithId:_current_];
}

- (id)initWithTripleplaySyncdbSyncDB_map_StorageMap_$2:(TripleplaySyncdbSyncDB_map_StorageMap_$2 *)outer$
                                  withJavaUtilIterator:(id<JavaUtilIterator>)capture$0 {
  if ((self = [super init])) {
    JreOperatorRetainedAssign(&this$0_, self, outer$);
    JreOperatorRetainedAssign(&val$iter_, self, capture$0);
  }
  return self;
}

- (void)dealloc {
  JreOperatorRetainedAssign(&val$iter_, self, nil);
  JreOperatorRetainedAssign(&_current_, self, nil);
  JreOperatorRetainedAssign(&this$0_, self, nil);
  [super dealloc];
}

- (void)copyAllPropertiesTo:(id)copy {
  [super copyAllPropertiesTo:copy];
  TripleplaySyncdbSyncDB_map_StorageMap_$2_$1 *typedCopy = (TripleplaySyncdbSyncDB_map_StorageMap_$2_$1 *) copy;
  typedCopy.this$0 = this$0_;
  typedCopy._current = _current_;
  typedCopy.val$iter = val$iter_;
}

@end
@implementation TripleplaySyncdbSyncDB_SubDB

- (TripleplaySyncdbSyncDB *)this$0 {
  return this$0_;
}
- (void)setThis$0:(TripleplaySyncdbSyncDB *)this$0 {
  JreOperatorRetainedAssign(&this$0_, self, this$0);
}
@synthesize this$0 = this$0_;
- (NSString *)_dbpre {
  return _dbpre_;
}
- (void)set_dbpre:(NSString *)_dbpre {
  JreOperatorRetainedAssign(&_dbpre_, self, _dbpre);
}
@synthesize _dbpre = _dbpre_;

- (id)initWithTripleplaySyncdbSyncDB:(TripleplaySyncdbSyncDB *)outer$
                        withNSString:(NSString *)prefix {
  if ((self = [super init])) {
    JreOperatorRetainedAssign(&this$0_, self, outer$);
    JreOperatorRetainedAssign(&_dbpre_, self, prefix);
  }
  return self;
}

- (ReactValue *)valueWithNSString:(NSString *)name
                           withId:(id)defval
        withTripleplaySyncdbCodec:(TripleplaySyncdbCodec *)codec
     withTripleplaySyncdbResolver:(id<TripleplaySyncdbResolver>)resolver {
  return ((ReactValue *) [this$0_ valueWithNSString:[self keyWithNSString:name] withId:defval withTripleplaySyncdbCodec:codec withTripleplaySyncdbResolver:resolver]);
}

- (ReactRSet *)setWithNSString:(NSString *)name
     withTripleplaySyncdbCodec:(TripleplaySyncdbCodec *)codec
withTripleplaySyncdbSetResolver:(id<TripleplaySyncdbSetResolver>)resolver {
  return ((ReactRSet *) [this$0_ setWithNSString:[self keyWithNSString:name] withTripleplaySyncdbCodec:codec withTripleplaySyncdbSetResolver:resolver]);
}

- (ReactRMap *)mapWithNSString:(NSString *)prefix
     withTripleplaySyncdbCodec:(TripleplaySyncdbCodec *)keyCodec
     withTripleplaySyncdbCodec:(TripleplaySyncdbCodec *)valCodec
  withTripleplaySyncdbResolver:(id<TripleplaySyncdbResolver>)resolver {
  return ((ReactRMap *) [this$0_ mapWithNSString:[self keyWithNSString:prefix] withTripleplaySyncdbCodec:keyCodec withTripleplaySyncdbCodec:valCodec withTripleplaySyncdbResolver:resolver]);
}

- (NSString *)keyWithNSString:(NSString *)name {
  return [TripleplaySyncdbDBUtil subDBKeyWithNSString:_dbpre_ withNSString:name];
}

- (void)purge {
  [this$0_ purgeDBsWithJavaUtilSet:((id<JavaUtilSet>) [JavaUtilCollections singletonWithId:_dbpre_])];
  (void) [((id<JavaUtilMap>) NIL_CHK(this$0_._subdbs)) removeWithId:_dbpre_];
}

- (void)queuePurge {
  id<JavaUtilSet> pendingPurges = ((id<JavaUtilSet>) [this$0_ sgetWithNSString:[TripleplaySyncdbSyncDB SYNC_PURGE_KEY] withTripleplaySyncdbCodec:[TripleplaySyncdbCodec STRING]]);
  [((id<JavaUtilSet>) NIL_CHK(pendingPurges)) addWithId:_dbpre_];
  [this$0_ ssetWithNSString:[TripleplaySyncdbSyncDB SYNC_PURGE_KEY] withJavaUtilSet:pendingPurges withTripleplaySyncdbCodec:[TripleplaySyncdbCodec STRING]];
  [((TripleplayUtilLogger *) NIL_CHK([TripleplaySyncdbLog log])) infoWithNSString:@"Queued purge" withNSObjectArray:[IOSObjectArray arrayWithType:[IOSClass classWithClass:[NSObject class]] count:4, @"subdb", _dbpre_, @"penders", pendingPurges ]];
  (void) [((id<JavaUtilMap>) NIL_CHK(this$0_._subdbs)) removeWithId:_dbpre_];
}

- (void)cancelQueuedPurge {
  id<JavaUtilSet> pendingPurges = ((id<JavaUtilSet>) [this$0_ sgetWithNSString:[TripleplaySyncdbSyncDB SYNC_PURGE_KEY] withTripleplaySyncdbCodec:[TripleplaySyncdbCodec STRING]]);
  if ([((id<JavaUtilSet>) NIL_CHK(pendingPurges)) removeWithId:_dbpre_]) {
    [this$0_ ssetWithNSString:[TripleplaySyncdbSyncDB SYNC_PURGE_KEY] withJavaUtilSet:pendingPurges withTripleplaySyncdbCodec:[TripleplaySyncdbCodec STRING]];
    [((TripleplayUtilLogger *) NIL_CHK([TripleplaySyncdbLog log])) infoWithNSString:@"Canceled queued purge" withNSObjectArray:[IOSObjectArray arrayWithType:[IOSClass classWithClass:[NSObject class]] count:4, @"subdb", _dbpre_, @"penders", pendingPurges ]];
  }
}

- (void)dealloc {
  JreOperatorRetainedAssign(&_dbpre_, self, nil);
  JreOperatorRetainedAssign(&this$0_, self, nil);
  [super dealloc];
}

- (void)copyAllPropertiesTo:(id)copy {
  [super copyAllPropertiesTo:copy];
  TripleplaySyncdbSyncDB_SubDB *typedCopy = (TripleplaySyncdbSyncDB_SubDB *) copy;
  typedCopy.this$0 = this$0_;
  typedCopy._dbpre = _dbpre_;
}

@end
@implementation TripleplaySyncdbSyncDB_$1

- (TripleplaySyncdbSyncDB *)this$0 {
  return this$0_;
}
- (void)setThis$0:(TripleplaySyncdbSyncDB *)this$0 {
  JreOperatorRetainedAssign(&this$0_, self, this$0);
}
@synthesize this$0 = this$0_;
- (NSString *)val$name {
  return val$name_;
}
- (void)setVal$name:(NSString *)val$name {
  JreOperatorRetainedAssign(&val$name_, self, val$name);
}
@synthesize val$name = val$name_;
- (id)val$defval {
  return val$defval_;
}
- (void)setVal$defval:(id)val$defval {
  JreOperatorRetainedAssign(&val$defval_, self, val$defval);
}
@synthesize val$defval = val$defval_;
- (TripleplaySyncdbCodec *)val$codec {
  return val$codec_;
}
- (void)setVal$codec:(TripleplaySyncdbCodec *)val$codec {
  JreOperatorRetainedAssign(&val$codec_, self, val$codec);
}
@synthesize val$codec = val$codec_;

- (id)get {
  return [this$0_ getWithNSString:val$name_ withId:val$defval_ withTripleplaySyncdbCodec:val$codec_];
}

- (id)updateLocalWithId:(id)value {
  id oldValue = [self get];
  [this$0_ setWithNSString:val$name_ withId:value withTripleplaySyncdbCodec:val$codec_];
  return oldValue;
}

- (void)emitChangeWithId:(id)value
                  withId:(id)ovalue {
  [super emitChangeWithId:value withId:ovalue];
  [this$0_ noteModifiedWithNSString:val$name_];
}

- (id)initWithTripleplaySyncdbSyncDB:(TripleplaySyncdbSyncDB *)outer$
                              withId:(id)arg$0
                        withNSString:(NSString *)capture$0
                              withId:(id)capture$1
           withTripleplaySyncdbCodec:(TripleplaySyncdbCodec *)capture$2 {
  if ((self = [super initWithId:arg$0])) {
    JreOperatorRetainedAssign(&this$0_, self, outer$);
    JreOperatorRetainedAssign(&val$name_, self, capture$0);
    JreOperatorRetainedAssign(&val$defval_, self, capture$1);
    JreOperatorRetainedAssign(&val$codec_, self, capture$2);
  }
  return self;
}

- (void)dealloc {
  JreOperatorRetainedAssign(&val$codec_, self, nil);
  JreOperatorRetainedAssign(&val$defval_, self, nil);
  JreOperatorRetainedAssign(&val$name_, self, nil);
  JreOperatorRetainedAssign(&this$0_, self, nil);
  [super dealloc];
}

- (void)copyAllPropertiesTo:(id)copy {
  [super copyAllPropertiesTo:copy];
  TripleplaySyncdbSyncDB_$1 *typedCopy = (TripleplaySyncdbSyncDB_$1 *) copy;
  typedCopy.this$0 = this$0_;
  typedCopy.val$name = val$name_;
  typedCopy.val$defval = val$defval_;
  typedCopy.val$codec = val$codec_;
}

@end
@implementation TripleplaySyncdbSyncDB_$2

- (TripleplaySyncdbSyncDB *)this$0 {
  return this$0_;
}
- (void)setThis$0:(TripleplaySyncdbSyncDB *)this$0 {
  JreOperatorRetainedAssign(&this$0_, self, this$0);
}
@synthesize this$0 = this$0_;
- (TripleplaySyncdbCodec *)val$codec {
  return val$codec_;
}
- (void)setVal$codec:(TripleplaySyncdbCodec *)val$codec {
  JreOperatorRetainedAssign(&val$codec_, self, val$codec);
}
@synthesize val$codec = val$codec_;
- (id)val$defval {
  return val$defval_;
}
- (void)setVal$defval:(id)val$defval {
  JreOperatorRetainedAssign(&val$defval_, self, val$defval);
}
@synthesize val$defval = val$defval_;
- (id<TripleplaySyncdbResolver>)val$resolver {
  return val$resolver_;
}
- (void)setVal$resolver:(id<TripleplaySyncdbResolver>)val$resolver {
  JreOperatorRetainedAssign(&val$resolver_, self, val$resolver);
}
@synthesize val$resolver = val$resolver_;
- (ReactValue *)val$value {
  return val$value_;
}
- (void)setVal$value:(ReactValue *)val$value {
  JreOperatorRetainedAssign(&val$value_, self, val$value);
}
@synthesize val$value = val$value_;
- (NSString *)val$name {
  return val$name_;
}
- (void)setVal$name:(NSString *)val$name {
  JreOperatorRetainedAssign(&val$name_, self, val$name);
}
@synthesize val$name = val$name_;

- (BOOL)mergeWithNSString:(NSString *)name
             withNSString:(NSString *)data {
  id svalue = [((TripleplaySyncdbCodec *) NIL_CHK(val$codec_)) decodeWithNSString:data withId:val$defval_];
  id nvalue = [((id<TripleplaySyncdbResolver>) NIL_CHK(val$resolver_)) resolveWithId:[((ReactValue *) NIL_CHK(val$value_)) get] withId:svalue];
  (void) [((ReactValue *) NIL_CHK(val$value_)) updateWithId:nvalue];
  return [NIL_CHK(nvalue) isEqual:svalue];
}

- (void)updateWithNSString:(NSString *)name
              withNSString:(NSString *)data {
  (void) [((ReactValue *) NIL_CHK(val$value_)) updateWithId:[((TripleplaySyncdbCodec *) NIL_CHK(val$codec_)) decodeWithNSString:data withId:val$defval_]];
}

- (void)prepareToMeld {
  [this$0_ noteModifiedWithNSString:val$name_];
}

- (id)initWithTripleplaySyncdbSyncDB:(TripleplaySyncdbSyncDB *)outer$
           withTripleplaySyncdbCodec:(TripleplaySyncdbCodec *)capture$0
                              withId:(id)capture$1
        withTripleplaySyncdbResolver:(id<TripleplaySyncdbResolver>)capture$2
                      withReactValue:(ReactValue *)capture$3
                        withNSString:(NSString *)capture$4 {
  if ((self = [super init])) {
    JreOperatorRetainedAssign(&this$0_, self, outer$);
    JreOperatorRetainedAssign(&val$codec_, self, capture$0);
    JreOperatorRetainedAssign(&val$defval_, self, capture$1);
    JreOperatorRetainedAssign(&val$resolver_, self, capture$2);
    JreOperatorRetainedAssign(&val$value_, self, capture$3);
    JreOperatorRetainedAssign(&val$name_, self, capture$4);
  }
  return self;
}

- (void)dealloc {
  JreOperatorRetainedAssign(&val$name_, self, nil);
  JreOperatorRetainedAssign(&val$value_, self, nil);
  JreOperatorRetainedAssign(&val$resolver_, self, nil);
  JreOperatorRetainedAssign(&val$defval_, self, nil);
  JreOperatorRetainedAssign(&val$codec_, self, nil);
  JreOperatorRetainedAssign(&this$0_, self, nil);
  [super dealloc];
}

- (void)copyAllPropertiesTo:(id)copy {
  [super copyAllPropertiesTo:copy];
  TripleplaySyncdbSyncDB_$2 *typedCopy = (TripleplaySyncdbSyncDB_$2 *) copy;
  typedCopy.this$0 = this$0_;
  typedCopy.val$codec = val$codec_;
  typedCopy.val$defval = val$defval_;
  typedCopy.val$resolver = val$resolver_;
  typedCopy.val$value = val$value_;
  typedCopy.val$name = val$name_;
}

@end
@implementation TripleplaySyncdbSyncDB_$3

- (TripleplaySyncdbSyncDB *)this$0 {
  return this$0_;
}
- (void)setThis$0:(TripleplaySyncdbSyncDB *)this$0 {
  JreOperatorRetainedAssign(&this$0_, self, this$0);
}
@synthesize this$0 = this$0_;
- (NSString *)val$name {
  return val$name_;
}
- (void)setVal$name:(NSString *)val$name {
  JreOperatorRetainedAssign(&val$name_, self, val$name);
}
@synthesize val$name = val$name_;
- (TripleplaySyncdbCodec *)val$codec {
  return val$codec_;
}
- (void)setVal$codec:(TripleplaySyncdbCodec *)val$codec {
  JreOperatorRetainedAssign(&val$codec_, self, val$codec);
}
@synthesize val$codec = val$codec_;

- (void)emitAddWithId:(id)elem {
  [super emitAddWithId:elem];
  [this$0_ ssetWithNSString:val$name_ withJavaUtilSet:_impl_ withTripleplaySyncdbCodec:val$codec_];
  [this$0_ noteModifiedWithNSString:val$name_];
}

- (void)emitRemoveWithId:(id)elem {
  [super emitRemoveWithId:elem];
  [this$0_ ssetWithNSString:val$name_ withJavaUtilSet:_impl_ withTripleplaySyncdbCodec:val$codec_];
  [this$0_ noteModifiedWithNSString:val$name_];
}

- (id)initWithTripleplaySyncdbSyncDB:(TripleplaySyncdbSyncDB *)outer$
                     withJavaUtilSet:(id<JavaUtilSet>)arg$0
                        withNSString:(NSString *)capture$0
           withTripleplaySyncdbCodec:(TripleplaySyncdbCodec *)capture$1 {
  if ((self = [super initWithJavaUtilSet:arg$0])) {
    JreOperatorRetainedAssign(&this$0_, self, outer$);
    JreOperatorRetainedAssign(&val$name_, self, capture$0);
    JreOperatorRetainedAssign(&val$codec_, self, capture$1);
  }
  return self;
}

- (void)dealloc {
  JreOperatorRetainedAssign(&val$codec_, self, nil);
  JreOperatorRetainedAssign(&val$name_, self, nil);
  JreOperatorRetainedAssign(&this$0_, self, nil);
  [super dealloc];
}

- (void)copyAllPropertiesTo:(id)copy {
  [super copyAllPropertiesTo:copy];
  TripleplaySyncdbSyncDB_$3 *typedCopy = (TripleplaySyncdbSyncDB_$3 *) copy;
  typedCopy.this$0 = this$0_;
  typedCopy.val$name = val$name_;
  typedCopy.val$codec = val$codec_;
}

@end
@implementation TripleplaySyncdbSyncDB_$4

- (TripleplaySyncdbSyncDB *)this$0 {
  return this$0_;
}
- (void)setThis$0:(TripleplaySyncdbSyncDB *)this$0 {
  JreOperatorRetainedAssign(&this$0_, self, this$0);
}
@synthesize this$0 = this$0_;
- (TripleplaySyncdbCodec *)val$codec {
  return val$codec_;
}
- (void)setVal$codec:(TripleplaySyncdbCodec *)val$codec {
  JreOperatorRetainedAssign(&val$codec_, self, val$codec);
}
@synthesize val$codec = val$codec_;
- (id<TripleplaySyncdbSetResolver>)val$resolver {
  return val$resolver_;
}
- (void)setVal$resolver:(id<TripleplaySyncdbSetResolver>)val$resolver {
  JreOperatorRetainedAssign(&val$resolver_, self, val$resolver);
}
@synthesize val$resolver = val$resolver_;
- (ReactRSet *)val$rset {
  return val$rset_;
}
- (void)setVal$rset:(ReactRSet *)val$rset {
  JreOperatorRetainedAssign(&val$rset_, self, val$rset);
}
@synthesize val$rset = val$rset_;
- (NSString *)val$name {
  return val$name_;
}
- (void)setVal$name:(NSString *)val$name {
  JreOperatorRetainedAssign(&val$name_, self, val$name);
}
@synthesize val$name = val$name_;

- (BOOL)mergeWithNSString:(NSString *)name
             withNSString:(NSString *)data {
  id<JavaUtilSet> sset = (data == nil) ? ((id<JavaUtilSet>) [JavaUtilCollections emptySet]) : ((id<JavaUtilSet>) [TripleplaySyncdbDBUtil decodeSetWithNSString:data withTripleplaySyncdbCodec:val$codec_]);
  [((id<TripleplaySyncdbSetResolver>) NIL_CHK(val$resolver_)) resolveWithJavaUtilSet:val$rset_ withJavaUtilSet:sset];
  return [((ReactRSet *) NIL_CHK(val$rset_)) isEqual:sset];
}

- (void)updateWithNSString:(NSString *)name
              withNSString:(NSString *)data {
  if (data == nil) [((ReactRSet *) NIL_CHK(val$rset_)) clear];
  else {
    id<JavaUtilSet> sset = ((id<JavaUtilSet>) [TripleplaySyncdbDBUtil decodeSetWithNSString:data withTripleplaySyncdbCodec:val$codec_]);
    [((ReactRSet *) NIL_CHK(val$rset_)) retainAllWithJavaUtilCollection:sset];
    [((ReactRSet *) NIL_CHK(val$rset_)) addAllWithJavaUtilCollection:sset];
  }
}

- (void)prepareToMeld {
  [this$0_ noteModifiedWithNSString:val$name_];
}

- (id)initWithTripleplaySyncdbSyncDB:(TripleplaySyncdbSyncDB *)outer$
           withTripleplaySyncdbCodec:(TripleplaySyncdbCodec *)capture$0
     withTripleplaySyncdbSetResolver:(id<TripleplaySyncdbSetResolver>)capture$1
                       withReactRSet:(ReactRSet *)capture$2
                        withNSString:(NSString *)capture$3 {
  if ((self = [super init])) {
    JreOperatorRetainedAssign(&this$0_, self, outer$);
    JreOperatorRetainedAssign(&val$codec_, self, capture$0);
    JreOperatorRetainedAssign(&val$resolver_, self, capture$1);
    JreOperatorRetainedAssign(&val$rset_, self, capture$2);
    JreOperatorRetainedAssign(&val$name_, self, capture$3);
  }
  return self;
}

- (void)dealloc {
  JreOperatorRetainedAssign(&val$name_, self, nil);
  JreOperatorRetainedAssign(&val$rset_, self, nil);
  JreOperatorRetainedAssign(&val$resolver_, self, nil);
  JreOperatorRetainedAssign(&val$codec_, self, nil);
  JreOperatorRetainedAssign(&this$0_, self, nil);
  [super dealloc];
}

- (void)copyAllPropertiesTo:(id)copy {
  [super copyAllPropertiesTo:copy];
  TripleplaySyncdbSyncDB_$4 *typedCopy = (TripleplaySyncdbSyncDB_$4 *) copy;
  typedCopy.this$0 = this$0_;
  typedCopy.val$codec = val$codec_;
  typedCopy.val$resolver = val$resolver_;
  typedCopy.val$rset = val$rset_;
  typedCopy.val$name = val$name_;
}

@end
@implementation TripleplaySyncdbSyncDB_$5

- (TripleplaySyncdbSyncDB *)this$0 {
  return this$0_;
}
- (void)setThis$0:(TripleplaySyncdbSyncDB *)this$0 {
  JreOperatorRetainedAssign(&this$0_, self, this$0);
}
@synthesize this$0 = this$0_;
- (TripleplaySyncdbCodec *)val$keyCodec {
  return val$keyCodec_;
}
- (void)setVal$keyCodec:(TripleplaySyncdbCodec *)val$keyCodec {
  JreOperatorRetainedAssign(&val$keyCodec_, self, val$keyCodec);
}
@synthesize val$keyCodec = val$keyCodec_;
- (NSString *)val$prefix {
  return val$prefix_;
}
- (void)setVal$prefix:(NSString *)val$prefix {
  JreOperatorRetainedAssign(&val$prefix_, self, val$prefix);
}
@synthesize val$prefix = val$prefix_;
- (ReactRMap *)val$map {
  return val$map_;
}
- (void)setVal$map:(ReactRMap *)val$map {
  JreOperatorRetainedAssign(&val$map_, self, val$map);
}
@synthesize val$map = val$map_;
- (TripleplaySyncdbCodec *)val$valCodec {
  return val$valCodec_;
}
- (void)setVal$valCodec:(TripleplaySyncdbCodec *)val$valCodec {
  JreOperatorRetainedAssign(&val$valCodec_, self, val$valCodec);
}
@synthesize val$valCodec = val$valCodec_;
- (id<TripleplaySyncdbResolver>)val$resolver {
  return val$resolver_;
}
- (void)setVal$resolver:(id<TripleplaySyncdbResolver>)val$resolver {
  JreOperatorRetainedAssign(&val$resolver_, self, val$resolver);
}
@synthesize val$resolver = val$resolver_;

- (BOOL)mergeWithNSString:(NSString *)name
             withNSString:(NSString *)data {
  id skey = [((TripleplaySyncdbCodec *) NIL_CHK(val$keyCodec_)) decodeWithNSString:[NIL_CHK(name) substring:[NIL_CHK(val$prefix_) length] + 1]];
  if (data == nil) {
    (void) [((ReactRMap *) NIL_CHK(val$map_)) removeWithId:skey];
    return YES;
  }
  id svalue = [((TripleplaySyncdbCodec *) NIL_CHK(val$valCodec_)) decodeWithNSString:data], nvalue = [((id<TripleplaySyncdbResolver>) NIL_CHK(val$resolver_)) resolveWithId:[((ReactRMap *) NIL_CHK(val$map_)) getWithId:skey] withId:svalue];
  (void) [((ReactRMap *) NIL_CHK(val$map_)) putWithId:skey withId:nvalue];
  return [NIL_CHK(nvalue) isEqual:svalue];
}

- (void)updateWithNSString:(NSString *)name
              withNSString:(NSString *)data {
  id skey = [((TripleplaySyncdbCodec *) NIL_CHK(val$keyCodec_)) decodeWithNSString:[NIL_CHK(name) substring:[NIL_CHK(val$prefix_) length] + 1]];
  if (data == nil) (void) [((ReactRMap *) NIL_CHK(val$map_)) removeWithId:skey];
  else (void) [((ReactRMap *) NIL_CHK(val$map_)) putWithId:skey withId:[((TripleplaySyncdbCodec *) NIL_CHK(val$valCodec_)) decodeWithNSString:data]];
}

- (void)prepareToMeld {
  {
    id<JavaUtilIterator> iter__ = ((id<JavaUtilIterator>) [((id<JavaUtilSet>) [((ReactRMap *) NIL_CHK(val$map_)) keySet]) iterator]);
    while ([((id<JavaUtilIterator>) NIL_CHK(iter__)) hasNext]) {
      id key = [((id<JavaUtilIterator>) NIL_CHK(iter__)) next];
      [this$0_ noteModifiedWithNSString:[TripleplaySyncdbDBUtil mapKeyWithNSString:val$prefix_ withId:key withTripleplaySyncdbCodec:val$keyCodec_]];
    }
  }
}

- (id)initWithTripleplaySyncdbSyncDB:(TripleplaySyncdbSyncDB *)outer$
           withTripleplaySyncdbCodec:(TripleplaySyncdbCodec *)capture$0
                        withNSString:(NSString *)capture$1
                       withReactRMap:(ReactRMap *)capture$2
           withTripleplaySyncdbCodec:(TripleplaySyncdbCodec *)capture$3
        withTripleplaySyncdbResolver:(id<TripleplaySyncdbResolver>)capture$4 {
  if ((self = [super init])) {
    JreOperatorRetainedAssign(&this$0_, self, outer$);
    JreOperatorRetainedAssign(&val$keyCodec_, self, capture$0);
    JreOperatorRetainedAssign(&val$prefix_, self, capture$1);
    JreOperatorRetainedAssign(&val$map_, self, capture$2);
    JreOperatorRetainedAssign(&val$valCodec_, self, capture$3);
    JreOperatorRetainedAssign(&val$resolver_, self, capture$4);
  }
  return self;
}

- (void)dealloc {
  JreOperatorRetainedAssign(&val$resolver_, self, nil);
  JreOperatorRetainedAssign(&val$valCodec_, self, nil);
  JreOperatorRetainedAssign(&val$map_, self, nil);
  JreOperatorRetainedAssign(&val$prefix_, self, nil);
  JreOperatorRetainedAssign(&val$keyCodec_, self, nil);
  JreOperatorRetainedAssign(&this$0_, self, nil);
  [super dealloc];
}

- (void)copyAllPropertiesTo:(id)copy {
  [super copyAllPropertiesTo:copy];
  TripleplaySyncdbSyncDB_$5 *typedCopy = (TripleplaySyncdbSyncDB_$5 *) copy;
  typedCopy.this$0 = this$0_;
  typedCopy.val$keyCodec = val$keyCodec_;
  typedCopy.val$prefix = val$prefix_;
  typedCopy.val$map = val$map_;
  typedCopy.val$valCodec = val$valCodec_;
  typedCopy.val$resolver = val$resolver_;
}

@end
@implementation TripleplaySyncdbSyncDB_$6

- (BOOL)mergeWithNSString:(NSString *)name
             withNSString:(NSString *)data {
  return YES;
}

- (void)updateWithNSString:(NSString *)name
              withNSString:(NSString *)data {
}

- (void)prepareToMeld {
}

- (id)init {
  return [super init];
}

- (void)dealloc {
  [super dealloc];
}

@end
@implementation TripleplaySyncdbSyncDB_$7

- (TripleplaySyncdbSyncDB *)this$0 {
  return this$0_;
}
- (void)setThis$0:(TripleplaySyncdbSyncDB *)this$0 {
  JreOperatorRetainedAssign(&this$0_, self, this$0);
}
@synthesize this$0 = this$0_;

- (void)run {
  [this$0_ flushMods];
  this$0_._flushQueued = NO;
}

- (id)initWithTripleplaySyncdbSyncDB:(TripleplaySyncdbSyncDB *)outer$ {
  if ((self = [super init])) {
    JreOperatorRetainedAssign(&this$0_, self, outer$);
  }
  return self;
}

- (void)dealloc {
  JreOperatorRetainedAssign(&this$0_, self, nil);
  [super dealloc];
}

- (void)copyAllPropertiesTo:(id)copy {
  [super copyAllPropertiesTo:copy];
  TripleplaySyncdbSyncDB_$7 *typedCopy = (TripleplaySyncdbSyncDB_$7 *) copy;
  typedCopy.this$0 = this$0_;
}

@end
