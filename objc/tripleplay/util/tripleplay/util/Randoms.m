//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: tripleplay/util/Randoms.java
//
//  Created by Thomas on 7/1/13.
//

#import "IOSObjectArray.h"
#import "java/lang/IllegalArgumentException.h"
#import "java/lang/Iterable.h"
#import "java/util/Collection.h"
#import "java/util/Iterator.h"
#import "java/util/List.h"
#import "java/util/ListIterator.h"
#import "java/util/Map.h"
#import "java/util/Random.h"
#import "java/util/RandomAccess.h"
#import "java/util/Set.h"

@implementation TripleplayUtilRandoms

- (JavaUtilRandom *)_r {
  return _r_;
}
- (void)set_r:(JavaUtilRandom *)_r {
  JreOperatorRetainedAssign(&_r_, self, _r);
}
@synthesize _r = _r_;

+ (TripleplayUtilRandoms *)withWithJavaUtilRandom:(JavaUtilRandom *)rand {
  return [[[TripleplayUtilRandoms alloc] initWithJavaUtilRandom:rand] autorelease];
}

- (int)getIntWithInt:(int)high {
  return [((JavaUtilRandom *) NIL_CHK(_r_)) nextIntWithInt:high];
}

- (int)getInRangeWithInt:(int)low
                 withInt:(int)high {
  return low + [((JavaUtilRandom *) NIL_CHK(_r_)) nextIntWithInt:high - low];
}

- (float)getFloatWithFloat:(float)high {
  return [((JavaUtilRandom *) NIL_CHK(_r_)) nextFloat] * high;
}

- (float)getInRangeWithFloat:(float)low
                   withFloat:(float)high {
  return low + ([((JavaUtilRandom *) NIL_CHK(_r_)) nextFloat] * (high - low));
}

- (BOOL)getChanceWithInt:(int)n {
  return (0 == [((JavaUtilRandom *) NIL_CHK(_r_)) nextIntWithInt:n]);
}

- (BOOL)getProbabilityWithFloat:(float)p {
  return [((JavaUtilRandom *) NIL_CHK(_r_)) nextFloat] < p;
}

- (BOOL)getBoolean {
  return [((JavaUtilRandom *) NIL_CHK(_r_)) nextBoolean];
}

- (float)getNormalWithFloat:(float)mean
                  withFloat:(float)dev {
  return (float) [((JavaUtilRandom *) NIL_CHK(_r_)) nextGaussian] * dev + mean;
}

- (void)shuffleWithJavaUtilList:(id<JavaUtilList>)list {
  int size = [((id<JavaUtilList>) NIL_CHK(list)) size];
  if ([(id) list conformsToProtocol: @protocol(JavaUtilRandomAccess)]) {
    for (int ii = size; ii > 1; ii--) {
      [TripleplayUtilRandoms swapWithJavaUtilList:list withInt:ii - 1 withInt:[((JavaUtilRandom *) NIL_CHK(_r_)) nextIntWithInt:ii]];
    }
  }
  else {
    IOSObjectArray *array = [((id<JavaUtilList>) NIL_CHK(list)) toArray];
    for (int ii = size; ii > 1; ii--) {
      [TripleplayUtilRandoms swapWithNSObjectArray:array withInt:ii - 1 withInt:[((JavaUtilRandom *) NIL_CHK(_r_)) nextIntWithInt:ii]];
    }
    id<JavaUtilListIterator> it = ((id<JavaUtilListIterator>) [((id<JavaUtilList>) NIL_CHK(list)) listIterator]);
    for (int ii = 0; ii < size; ii++) {
      (void) [((id<JavaUtilListIterator>) NIL_CHK(it)) next];
      id elem = (id) [((IOSObjectArray *) NIL_CHK(array)) objectAtIndex:ii];
      [((id<JavaUtilListIterator>) NIL_CHK(it)) setWithId:elem];
    }
  }
}

- (id)pickWithJavaUtilIterator:(id<JavaUtilIterator>)iterator
                        withId:(id)ifEmpty {
  if (![((id<JavaUtilIterator>) NIL_CHK(iterator)) hasNext]) {
    return ifEmpty;
  }
  id pick = [((id<JavaUtilIterator>) NIL_CHK(iterator)) next];
  for (int count = 2; [((id<JavaUtilIterator>) NIL_CHK(iterator)) hasNext]; count++) {
    id next = [((id<JavaUtilIterator>) NIL_CHK(iterator)) next];
    if (0 == [((JavaUtilRandom *) NIL_CHK(_r_)) nextIntWithInt:count]) {
      pick = next;
    }
  }
  return pick;
}

- (id)pickWithJavaLangIterable:(id<JavaLangIterable>)iterable
                        withId:(id)ifEmpty {
  return [self pickPluckWithJavaLangIterable:iterable withId:ifEmpty withBOOL:NO];
}

- (id)pickWithJavaUtilMap:(id<JavaUtilMap>)weightMap
                   withId:(id)ifEmpty {
  id pick = ifEmpty;
  double total = 0.0;
  {
    id<JavaUtilIterator> iter__ = ((id<JavaUtilIterator>) [((id<JavaUtilSet>) [((id<JavaUtilMap>) NIL_CHK(weightMap)) entrySet]) iterator]);
    while ([((id<JavaUtilIterator>) NIL_CHK(iter__)) hasNext]) {
      id<JavaUtilMap_Entry> entry = ((id<JavaUtilMap_Entry>) [((id<JavaUtilIterator>) NIL_CHK(iter__)) next]);
      double weight = [((NSNumber *) [((id<JavaUtilMap_Entry>) NIL_CHK(entry)) getValue]) doubleValue];
      if (weight > 0.0) {
        total += weight;
        if ((total == weight) || (([((JavaUtilRandom *) NIL_CHK(_r_)) nextDouble] * total) < weight)) {
          pick = [((id<JavaUtilMap_Entry>) NIL_CHK(entry)) getKey];
        }
      }
      else if (weight < 0.0) {
        @throw [[[JavaLangIllegalArgumentException alloc] initWithNSString:[NSString stringWithFormat:@"Weight less than 0: %@", entry]] autorelease];
      }
    }
  }
  return pick;
}

- (id)pluckWithJavaLangIterable:(id<JavaLangIterable>)iterable
                         withId:(id)ifEmpty {
  return [self pickPluckWithJavaLangIterable:iterable withId:ifEmpty withBOOL:YES];
}

- (id)initWithJavaUtilRandom:(JavaUtilRandom *)rand {
  if ((self = [super init])) {
    JreOperatorRetainedAssign(&_r_, self, rand);
  }
  return self;
}

- (id)pickPluckWithJavaLangIterable:(id<JavaLangIterable>)iterable
                             withId:(id)ifEmpty
                           withBOOL:(BOOL)remove {
  if ([(id) iterable conformsToProtocol: @protocol(JavaUtilCollection)]) {
    id<JavaUtilCollection> coll = (id<JavaUtilCollection>) iterable;
    int size = [((id<JavaUtilCollection>) NIL_CHK(coll)) size];
    if (size == 0) {
      return ifEmpty;
    }
    if ([(id) coll conformsToProtocol: @protocol(JavaUtilList)]) {
      id<JavaUtilList> list = (id<JavaUtilList>) coll;
      int idx = [((JavaUtilRandom *) NIL_CHK(_r_)) nextIntWithInt:size];
      if (remove) {
        return [((id<JavaUtilList>) NIL_CHK(list)) removeWithInt:idx];
      }
      return [((id<JavaUtilList>) NIL_CHK(list)) getWithInt:idx];
    }
    id<JavaUtilIterator> it = ((id<JavaUtilIterator>) [((id<JavaUtilCollection>) NIL_CHK(coll)) iterator]);
    for (int idx = [((JavaUtilRandom *) NIL_CHK(_r_)) nextIntWithInt:size]; idx > 0; idx--) {
      (void) [((id<JavaUtilIterator>) NIL_CHK(it)) next];
    }
    @try {
      return [((id<JavaUtilIterator>) NIL_CHK(it)) next];
    }
    @finally {
      if (remove) {
        [((id<JavaUtilIterator>) NIL_CHK(it)) remove];
      }
    }
  }
  if (!remove) {
    return [self pickWithJavaUtilIterator:((id<JavaUtilIterator>) [((id<JavaLangIterable>) NIL_CHK(iterable)) iterator]) withId:ifEmpty];
  }
  id<JavaUtilIterator> it = ((id<JavaUtilIterator>) [((id<JavaLangIterable>) NIL_CHK(iterable)) iterator]);
  if (![((id<JavaUtilIterator>) NIL_CHK(it)) hasNext]) {
    return ifEmpty;
  }
  id<JavaUtilIterator> lagIt = ((id<JavaUtilIterator>) [((id<JavaLangIterable>) NIL_CHK(iterable)) iterator]);
  id pick = [((id<JavaUtilIterator>) NIL_CHK(it)) next];
  (void) [((id<JavaUtilIterator>) NIL_CHK(lagIt)) next];
  for (int count = 2, lag = 1; [((id<JavaUtilIterator>) NIL_CHK(it)) hasNext]; count++, lag++) {
    id next = [((id<JavaUtilIterator>) NIL_CHK(it)) next];
    if (0 == [((JavaUtilRandom *) NIL_CHK(_r_)) nextIntWithInt:count]) {
      pick = next;
      for (; lag > 0; lag--) {
        (void) [((id<JavaUtilIterator>) NIL_CHK(lagIt)) next];
      }
    }
  }
  [((id<JavaUtilIterator>) NIL_CHK(lagIt)) remove];
  return pick;
}

+ (void)swapWithJavaUtilList:(id<JavaUtilList>)list
                     withInt:(int)ii
                     withInt:(int)jj {
  (void) [((id<JavaUtilList>) NIL_CHK(list)) setWithInt:ii withId:[((id<JavaUtilList>) NIL_CHK(list)) setWithInt:jj withId:[((id<JavaUtilList>) NIL_CHK(list)) getWithInt:ii]]];
}

+ (void)swapWithNSObjectArray:(IOSObjectArray *)array
                      withInt:(int)ii
                      withInt:(int)jj {
  id tmp = [((IOSObjectArray *) NIL_CHK(array)) objectAtIndex:ii];
  [((IOSObjectArray *) NIL_CHK(array)) replaceObjectAtIndex:ii withObject:[((IOSObjectArray *) NIL_CHK(array)) objectAtIndex:jj]];
  [((IOSObjectArray *) NIL_CHK(array)) replaceObjectAtIndex:jj withObject:tmp];
}

- (void)dealloc {
  JreOperatorRetainedAssign(&_r_, self, nil);
  [super dealloc];
}

- (void)copyAllPropertiesTo:(id)copy {
  [super copyAllPropertiesTo:copy];
  TripleplayUtilRandoms *typedCopy = (TripleplayUtilRandoms *) copy;
  typedCopy._r = _r_;
}

@end
